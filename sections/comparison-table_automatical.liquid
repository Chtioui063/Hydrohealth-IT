{% comment %}
  Section: Comparison Table (Automatique)
  - Version compl√®te avec : images, arrondis, responsive, couleurs dynamiques
  - Ajout : option "Titre en gras ?" + "Texte sous le titre"
  - Ajout : image de fond ou couleur de fond personnalisable
{% endcomment %}

<section id="cmp-{{ section.id }}">
  <style>
    #cmp-{{ section.id }} {
      {% if section.settings.bg_image_desktop != blank %}
        background-image: url('{{ section.settings.bg_image_desktop | image_url: width: 1920 }}');
        background-size: {{ section.settings.bg_size | default: 'cover' }};
        background-position: {{ section.settings.bg_position | default: 'center' }};
        background-repeat: {{ section.settings.bg_repeat | default: 'no-repeat' }};
      {% elsif section.settings.bg_color != blank %}
        background-color: {{ section.settings.bg_color }};
      {% endif %}
      padding: {{ section.settings.section_padding_top | default: 40 }}px {{ section.settings.section_padding_sides | default: 20 }}px {{ section.settings.section_padding_bottom | default: 40 }}px;
    }

    #cmp-{{ section.id }} .comparison-table {
      --radius: {{ section.settings.radius | default: 18 | plus: 0 }}px;
      --pill: {{ section.settings.pill_color | default: '#FE807B' }};
      --pill-fg: {{ section.settings.pill_color_fg | default: '#ffffff' }};
      --yes-color: {{ section.settings.yes_color | default: '#FFB6AF' }};
      --no-color: {{ section.settings.no_color | default: '#dddddd' }};

      width: 100%;
      max-width: {{ section.settings.max_width | default: 680 | plus: 0 }}px;
      margin: 0 auto;
      border-collapse: separate;
      border-spacing: 0;
      background: transparent;
      font-family: {{ section.settings.font_stack | default: '"Montserrat", "Segoe UI", Arial, sans-serif' }};
      table-layout: fixed;
    }

    #cmp-{{ section.id }} .comparison-table th,
    #cmp-{{ section.id }} .comparison-table td {
      padding: 14px 16px;
      text-align: center;
      vertical-align: middle;
      font-size: 0.96rem;
      line-height: 1.4;
      position: relative;
    }

    #cmp-{{ section.id }} .comparison-table th:first-child,
    #cmp-{{ section.id }} .comparison-table td:first-child {
      text-align: left;
      font-weight: 300;
      font-size: 1rem;
      color: #333;
      word-break: break-word;
    }

    /* Bloc du titre + sous-texte */
    #cmp-{{ section.id }} .feature-label {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    #cmp-{{ section.id }} .feature-label strong {
      font-weight: 600;
    }
    #cmp-{{ section.id }} .feature-label .subtext {
      font-size: 0.85rem;
      line-height: 1.3;
      color: #666;
    }

    /* Colonne rose (Luvaya) */
    #cmp-{{ section.id }} .comparison-table thead th:nth-child(2),
    #cmp-{{ section.id }} .comparison-table tbody td:nth-child(2) {
      background: var(--pill);
      color: var(--pill-fg);
      position: relative;
      z-index: 1;
    }
    #cmp-{{ section.id }} .comparison-table thead th:nth-child(2) {
      border-top-left-radius: var(--radius);
      border-top-right-radius: var(--radius);
    }
    #cmp-{{ section.id }} .comparison-table tbody tr:last-child td:nth-child(2) {
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      padding-bottom: 14px;
    }
    #cmp-{{ section.id }} .comparison-table tbody tr:last-child td:nth-child(2)::after {
      content: "";
      position: absolute;
      left: 0; right: 0;
      bottom: -20px;
      height: 40px;
      background: var(--pill);
      border-bottom-left-radius: var(--radius);
      border-bottom-right-radius: var(--radius);
      pointer-events: none;
      z-index: -1;
    }

    /* Pastilles oui/non */
    #cmp-{{ section.id }} .comparison-table td.yes,
    #cmp-{{ section.id }} .comparison-table td.no { font-size: 0; }

    #cmp-{{ section.id }} .comparison-table td.yes::before,
    #cmp-{{ section.id }} .comparison-table td.no::before {
      content: "";
      display: inline-block;
      width: 22px; height: 22px;
      border-radius: 50%;
      background-repeat: no-repeat;
      background-position: center;
      background-size: 12px 12px;
    }
    #cmp-{{ section.id }} .comparison-table td.yes::before {
      background-color: var(--yes-color);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23fff" viewBox="0 0 448 512"><path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4z"/></svg>');
    }
    #cmp-{{ section.id }} .comparison-table td.no::before {
      background-color: var(--no-color);
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" fill="%23999" viewBox="0 0 320 512"><path d="M310.6 361.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L160 301.3 54.6 406.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L114.7 256 9.4 150.6C-3.1 138.1-3.1 117.9 9.4 105.4s32.8-12.5 45.3 0L160 210.7 265.4 105.4c12.5-12.5 32.8-12.5 45.3 0s12.5 32.8 0 45.3L205.3 256 310.6 361.4z"/></svg>');
    }

    /* Logos */
    #cmp-{{ section.id }} .comparison-table thead img {
      display: inline-block;
      height: clamp(60px, 10vw, 90px);
      width: auto;
    }

    /* Mobile */
    @media (max-width: 640px) {
      #cmp-{{ section.id }} {
        {% if section.settings.bg_image_mobile != blank %}
          background-image: url('{{ section.settings.bg_image_mobile | image_url: width: 800 }}') !important;
          background-size: {{ section.settings.bg_size_mobile | default: 'cover' }};
          background-position: {{ section.settings.bg_position_mobile | default: 'center' }};
          background-repeat: {{ section.settings.bg_repeat | default: 'no-repeat' }};
        {% endif %}
        padding: {{ section.settings.section_padding_top | default: 40 | divided_by: 2 }}px {{ section.settings.section_padding_sides | default: 20 | divided_by: 2 }}px {{ section.settings.section_padding_bottom | default: 40 | divided_by: 2 }}px;
      }
      #cmp-{{ section.id }} .comparison-table th,
      #cmp-{{ section.id }} .comparison-table td { padding: 10px 12px; font-size: 0.9rem; }
      #cmp-{{ section.id }} .comparison-table th:first-child,
      #cmp-{{ section.id }} .comparison-table td:first-child { font-size: 0.95rem; }
      #cmp-{{ section.id }} .comparison-table thead img { height: clamp(70px, 18vw, 100px); }
      #cmp-{{ section.id }} .comparison-table td.yes::before,
      #cmp-{{ section.id }} .comparison-table td.no::before { width: 20px; height: 20px; background-size: 11px 11px; }
    }
  </style>

  <table class="comparison-table" role="table" aria-label="{{ section.settings.aria_label | escape }}">
    <colgroup>
      <col style="width:{{ section.settings.col1_width | default: '50' }}%">
      <col style="width:{{ section.settings.col2_width | default: '25' }}%">
      <col style="width:{{ section.settings.col3_width | default: '25' }}%">
    </colgroup>

    <thead class="isolate">
      <tr>
        <th></th>
        <th align="center">
          {% if section.settings.img_left != blank %}
            {{ section.settings.img_left
              | image_url: width: 352
              | image_tag:
                  alt: section.settings.img_left_alt,
                  loading: 'lazy' }}
          {% else %}
            {{ section.settings.fallback_left | escape }}
          {% endif %}
        </th>
        <th align="center">
          {% if section.settings.img_right != blank %}
            {{ section.settings.img_right
              | image_url: width: 352
              | image_tag:
                  alt: section.settings.img_right_alt,
                  loading: 'lazy' }}
          {% else %}
            {{ section.settings.fallback_right | escape }}
          {% endif %}
        </th>
      </tr>
    </thead>

    <tbody class="isolate">
      {%- for block in section.blocks -%}
        {%- case block.type -%}
          {%- when 'price' -%}
            <tr {{ block.shopify_attributes }}>
              <td><strong>{{ block.settings.label | escape }}</strong></td>
              <td class="price">{{ block.settings.left_text }}</td>
              <td class="price">{{ block.settings.right_text }}</td>
            </tr>

          {%- when 'feature' -%}
            <tr {{ block.shopify_attributes }}>
              <td>
                <div class="feature-label">
                  {% if block.settings.title_bold %}
                    <strong>{{ block.settings.label | escape }}</strong>
                  {% else %}
                    <span>{{ block.settings.label | escape }}</span>
                  {% endif %}
                  {% if block.settings.subtext != blank %}
                    <span class="subtext">{{ block.settings.subtext }}</span>
                  {% endif %}
                </div>
              </td>
              <td class="{% if block.settings.left_yes %}yes{% else %}no{% endif %}"></td>
              <td class="{% if block.settings.right_yes %}yes{% else %}no{% endif %}"></td>
            </tr>
        {%- endcase -%}
      {%- endfor -%}
    </tbody>
  </table>
</section>

{% schema %}
{
  "name": "Tableau comparatif auto",
  "settings": [
    {
      "type": "header",
      "content": "üñºÔ∏è Fond Desktop (√©crans larges)"
    },
    { 
      "type": "image_picker", 
      "id": "bg_image_desktop", 
      "label": "Image de fond Desktop",
      "info": "Image affich√©e sur √©crans > 640px"
    },
    {
      "type": "select",
      "id": "bg_size",
      "label": "Taille image Desktop",
      "options": [
        { "value": "cover", "label": "Couvrir" },
        { "value": "contain", "label": "Contenir" },
        { "value": "auto", "label": "Automatique" }
      ],
      "default": "cover"
    },
    {
      "type": "select",
      "id": "bg_position",
      "label": "Position image Desktop",
      "options": [
        { "value": "center", "label": "Centre" },
        { "value": "top", "label": "Haut" },
        { "value": "bottom", "label": "Bas" },
        { "value": "left", "label": "Gauche" },
        { "value": "right", "label": "Droite" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "üì± Fond Mobile (petits √©crans)"
    },
    { 
      "type": "image_picker", 
      "id": "bg_image_mobile", 
      "label": "Image de fond Mobile",
      "info": "Image affich√©e sur √©crans ‚â§ 640px"
    },
    {
      "type": "select",
      "id": "bg_size_mobile",
      "label": "Taille image Mobile",
      "options": [
        { "value": "cover", "label": "Couvrir" },
        { "value": "contain", "label": "Contenir" },
        { "value": "auto", "label": "Automatique" }
      ],
      "default": "cover"
    },
    {
      "type": "select",
      "id": "bg_position_mobile",
      "label": "Position image Mobile",
      "options": [
        { "value": "center", "label": "Centre" },
        { "value": "top", "label": "Haut" },
        { "value": "bottom", "label": "Bas" },
        { "value": "left", "label": "Gauche" },
        { "value": "right", "label": "Droite" }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Options communes"
    },
    {
      "type": "select",
      "id": "bg_repeat",
      "label": "R√©p√©tition de l'image",
      "options": [
        { "value": "no-repeat", "label": "Pas de r√©p√©tition" },
        { "value": "repeat", "label": "R√©p√©ter" },
        { "value": "repeat-x", "label": "R√©p√©ter horizontalement" },
        { "value": "repeat-y", "label": "R√©p√©ter verticalement" }
      ],
      "default": "no-repeat"
    },
    { 
      "type": "color", 
      "id": "bg_color", 
      "label": "Couleur de fond (si pas d'image)",
      "info": "Utilis√©e uniquement si aucune image de fond n'est s√©lectionn√©e"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "label": "Espacement haut (px)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 40
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "label": "Espacement bas (px)",
      "min": 0,
      "max": 120,
      "step": 5,
      "default": 40
    },
    {
      "type": "range",
      "id": "section_padding_sides",
      "label": "Espacement lat√©ral (px)",
      "min": 0,
      "max": 60,
      "step": 5,
      "default": 20
    },
    {
      "type": "header",
      "content": "Configuration du tableau"
    },
    { "type": "text", "id": "aria_label", "label": "Libell√© ARIA du tableau", "default": "Comparatif Luvaya vs Filler Tradizionali" },
    { "type": "image_picker", "id": "img_left", "label": "Image colonne 2 (Luvaya)" },
    { "type": "text", "id": "img_left_alt", "label": "Texte alternatif image gauche", "default": "Luvaya" },
    { "type": "text", "id": "fallback_left", "label": "Texte fallback gauche", "default": "Luvaya" },
    { "type": "image_picker", "id": "img_right", "label": "Image colonne 3 (Autre / Filler)" },
    { "type": "text", "id": "img_right_alt", "label": "Texte alternatif image droite", "default": "Filler Tradizionali" },
    { "type": "text", "id": "fallback_right", "label": "Texte fallback droite", "default": "Filler Tradizionali" },
    {
      "type": "header",
      "content": "Couleurs"
    },
    { "type": "color", "id": "pill_color", "label": "Couleur colonne Luvaya", "default": "#FE807B" },
    { "type": "color", "id": "pill_color_fg", "label": "Couleur texte colonne Luvaya", "default": "#FFFFFF" },
    { "type": "color", "id": "yes_color", "label": "Couleur pastille OUI", "default": "#FFB6AF" },
    { "type": "color", "id": "no_color", "label": "Couleur pastille NON", "default": "#DDDDDD" },
    {
      "type": "header",
      "content": "Style"
    },
    { "type": "text", "id": "font_stack", "label": "Police", "default": "\"Montserrat\", \"Segoe UI\", Arial, sans-serif" },
    { "type": "range", "id": "radius", "label": "Rayon des coins", "min": 0, "max": 36, "step": 1, "default": 18 },
    { "type": "range", "id": "max_width", "label": "Largeur max (px)", "min": 480, "max": 1400, "step": 10, "default": 680 }
  ],
  "blocks": [
    {
      "type": "price",
      "name": "Ligne prix",
      "settings": [
        { "type": "text", "id": "label", "label": "Libell√©", "default": "Prix" },
        { "type": "text", "id": "left_text", "label": "Texte Luvaya", "default": "D√®s 39,90‚Ç¨" },
        { "type": "text", "id": "right_text", "label": "Texte Filler", "default": "D√®s 350‚Ç¨" }
      ]
    },
    {
      "type": "feature",
      "name": "Ligne crit√®re",
      "settings": [
        { "type": "text", "id": "label", "label": "Titre du crit√®re", "default": "R√©sultats durables" },
        { "type": "checkbox", "id": "title_bold", "label": "Titre en gras ?", "default": true },
        { "type": "text", "id": "subtext", "label": "Texte sous le titre (optionnel)", "default": "Effets visibles jusqu'√† 3 semaines." },
        { "type": "checkbox", "id": "left_yes", "label": "Luvaya (Oui ?)", "default": true },
        { "type": "checkbox", "id": "right_yes", "label": "Filler (Oui ?)", "default": true }
      ]
    }
  ],
  "presets": [
    {
      "name": "Tableau comparatif"
    }
  ]
}
{% endschema %}